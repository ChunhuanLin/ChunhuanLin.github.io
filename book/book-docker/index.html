<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            《Docker-从入门到实践》 | 
        
        Chlin&#39;s Blog
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
        <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Chunhuan Lin">
    <meta name="description" itemprop="description" content="Personal blog, major in cv, deep learning, linux and so on.">
    <meta name="keywords" content="null,tools,notes,docker">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Chlin&#39;s Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.chlin.win">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="《Docker-从入门到实践》 | Chlin&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="Personal blog, major in cv, deep learning, linux and so on.">
    <meta property="og:article:tag" content="tools"> <meta property="og:article:tag" content="notes"> <meta property="og:article:tag" content="docker"> 

    
        <meta property="article:published_time" content="9月 05, 2018" />
        <meta property="article:modified_time" content="9月 13, 2018" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="《Docker-从入门到实践》 | Chlin&#39;s Blog">
    <meta name="twitter:description" content="Personal blog, major in cv, deep learning, linux and so on.">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://www.chlin.win" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://www.chlin.win/book/book-docker/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Chlin&#39;s Blog",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "Chunhuan Lin",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "Hi, nice to meet you"
    },
    "headline": "《Docker-从入门到实践》",
    "url": "http://www.chlin.win/book/book-docker/index.html",
    "datePublished": "9月 05, 2018",
    "dateModified": "9月 13, 2018",
    "description": "Personal blog, major in cv, deep learning, linux and so on.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://www.chlin.win"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    
    
    
    
    
    
    .footer-sns-github {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNCA3OGMtNi40IDEuNC0yNi40IDE0LjItMzYgMjIuOC04IDcuMi0yMiAyOS44LTI0LjQgMzkuMi0xLjYgNi40LTIgMTEzLjItMS42IDM2OCAuNiAyOTkuNCAxIDM1OS44IDMuNCAzNjQgMTEgMjAuMiAyMS42IDMyLjQgMzcuMiA0MyAxNS42IDEwLjYgMTcuMiAxMS4yIDM0LjIgMTMuMiAxMC42IDEuMiA2My40IDEuNiAxMjcuNiAxLjRsMTA5LjYtLjYgNi02LjggNi4yLTYuOC0xLjItMjUuMmMtLjgtMTUuOC0uMi0zMy40IDEuNC00Ny4yIDMtMjUuNCAxLjQtMzYuMi02LTQzLjItNS00LjYtNi4yLTQuOC0zMC42LTQuMi0yNy42LjgtMjQgMS42LTY4LjgtMTYtOC42LTMuNC0yMi42LTE4LTI4LjQtMjkuOC0xMS40LTIyLjgtMjctNDUtMzkuMi01NS42LTE0LTEyLjItMTkuOC0yMC44LTE5LjgtMjguNiAwLTExLjYgMTMuNi0xMi42IDMzLjItMi40IDE2LjYgOC44IDIwLjggMTIuNCA0MC44IDM2LjIgMjQuMiAyOC42IDMxIDMzLjYgNTQgMzkuNiAxNS4yIDQgNDIuMiAzIDUxLjQtMS44IDktNC42IDE4LTE1LjIgMjQuNC0yOS4yIDExLjQtMjQuMiA3LjQtMzEuMi0yMC42LTM2LjgtOS44LTItMjkuMi04LTQzLjQtMTMuNC00MC40LTE1LjgtNjQuNi0zNy40LTg1LjQtNzYuMi0xMS42LTIxLjgtMTUuNC0zMy0xOC4yLTUzLjYtNC4yLTMyLjItNC44LTYwLjItMS40LTg0IDMuNC0yMy44IDYuOC0zMi44IDIwLjItNTQgNC02IDguOC0xNS42IDExLTIxLjQgMy44LTEwIDMuOC0xMS42IDEtMzAtNS4yLTM0LjItMy4yLTUyLjQgNy42LTcwLjIgNy4yLTEyLjIgMTUtMTcuMiAyNC4yLTE1LjggMTIuOCAyLjIgNTIgMTcuNCA2Ni44IDI2LjIgMjYgMTUgMjkgMTUuNCA4Mi40IDcuMiAyNC42LTMuOCAzMy44LTQuMiA2MC0zLjIgMTcgLjYgNDEuNCAzIDU0IDUuMiAzOC40IDYuNiA0OS42IDUuMiA3My0xMCA2LjYtNC4yIDE3LjQtOS40IDI0LTExLjYgNi42LTIuMiAxNi01LjggMjEtOC4yIDEzLTYgMjgtNS42IDM1LjYuOCAxMi40IDEwLjQgMTguNiA0MS40IDE0LjQgNzEuNi00LjQgMzAuNi0zIDM5LjQgOC40IDUzLjggMy40IDQuNCAxMS4yIDE5LjIgMTcuNCAzMy4yTDc3NSA0NDN2NzhsLTEwIDI4Yy0xNS4yIDQzLjItMzYuOCA3My4yLTY2LjIgOTIuOC0xMy40IDguOC01NyAyNS40LTc2LjggMjktMjguMiA1LjItMzMuMiAxMi42LTIyIDMyLjIgMTEuMiAxOS40IDEyLjQgMzIuOCAxMS42IDEyOS42bC0uNiA4NS44IDUuNCA0LjZjMy42IDMgOS4yIDUuMiAxNiA2IDUuOC44IDYwLjIgMSAxMjAuNi42IDEwOC40LS42IDExMC4yLS42IDExOS01IDI0LTExLjYgNDAtMjcuNCA1MS42LTUwLjZsNS40LTExIC42LTM0N2MuNC0yMjMtLjItMzUzLjQtMS40LTM2NS0yLTE3LTIuNi0xOC42LTEzLTM0LTEwLjYtMTUuNC0yMi44LTI2LjItNDMuMi0zNy4yLTQuMi0yLjQtNjQuNi0yLjgtMzY2LTMuMi0xOTguNiAwLTM2NCAuNC0zNjcuNiAxLjR6Ii8+PC9zdmc+);
    }
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本概念"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker镜像"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Docker镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#分层存储"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">分层存储</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker容器"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Docker容器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker-Registry"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Docker Registry</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Docker-Registry-公开服务"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">Docker Registry 公开服务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#私有-Docker-Registry"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">私有 Docker Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#高级服务"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">高级服务</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装Docker"><span class="post-toc-number">2.</span> <span class="post-toc-text">安装Docker</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用镜像"><span class="post-toc-number">3.</span> <span class="post-toc-text">使用镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取镜像"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">获取镜像</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#运行"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">运行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#列出镜像"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">列出镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#镜像体积"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">镜像体积</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#虚悬镜像"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">虚悬镜像</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#中间层镜像"><span class="post-toc-number">3.3.3.</span> <span class="post-toc-text">中间层镜像</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#列出部分镜像"><span class="post-toc-number">3.3.4.</span> <span class="post-toc-text">列出部分镜像</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除本地镜像"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">删除本地镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#用ID、镜像名、摘要删除镜像"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">用ID、镜像名、摘要删除镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Untagged-和Deleted"><span class="post-toc-number">3.4.1.1.</span> <span class="post-toc-text">Untagged 和Deleted</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用commit理解镜像构成"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">利用commit理解镜像构成</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#慎用docker-commit"><span class="post-toc-number">3.5.1.</span> <span class="post-toc-text">慎用docker commit</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用Dockerfile定制镜像"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">使用Dockerfile定制镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#FROM指定基础镜像"><span class="post-toc-number">3.6.1.</span> <span class="post-toc-text">FROM指定基础镜像</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#RUN执行命令"><span class="post-toc-number">3.6.2.</span> <span class="post-toc-text">RUN执行命令</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构建镜像"><span class="post-toc-number">3.6.3.</span> <span class="post-toc-text">构建镜像</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#镜像构建上下文（Context）"><span class="post-toc-number">3.6.4.</span> <span class="post-toc-text">镜像构建上下文（Context）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#其他docker-build用法"><span class="post-toc-number">3.6.5.</span> <span class="post-toc-text">其他docker build用法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dockerfile指令详解"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">Dockerfile指令详解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#COPY复制文件"><span class="post-toc-number">3.7.1.</span> <span class="post-toc-text">COPY复制文件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ADD更高级的复制文件"><span class="post-toc-number">3.7.2.</span> <span class="post-toc-text">ADD更高级的复制文件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#CMD容器启动命令"><span class="post-toc-number">3.7.3.</span> <span class="post-toc-text">CMD容器启动命令</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ENTRYPOINT入口点"><span class="post-toc-number">3.7.4.</span> <span class="post-toc-text">ENTRYPOINT入口点</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ENV设置环境变量"><span class="post-toc-number">3.7.5.</span> <span class="post-toc-text">ENV设置环境变量</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ARG构建参数"><span class="post-toc-number">3.7.6.</span> <span class="post-toc-text">ARG构建参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#VOLUME定义匿名卷"><span class="post-toc-number">3.7.7.</span> <span class="post-toc-text">VOLUME定义匿名卷</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#EXPOSE声明端口"><span class="post-toc-number">3.7.8.</span> <span class="post-toc-text">EXPOSE声明端口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WORKDIR指定工作目录"><span class="post-toc-number">3.7.9.</span> <span class="post-toc-text">WORKDIR指定工作目录</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#USER指定当前用户"><span class="post-toc-number">3.7.10.</span> <span class="post-toc-text">USER指定当前用户</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#HEALTHCHECK健康检查"><span class="post-toc-number">3.7.11.</span> <span class="post-toc-text">HEALTHCHECK健康检查</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ONBUILD为他人做嫁衣裳"><span class="post-toc-number">3.7.12.</span> <span class="post-toc-text">ONBUILD为他人做嫁衣裳</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多阶段构建"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">多阶段构建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#之前的做法"><span class="post-toc-number">3.8.1.</span> <span class="post-toc-text">之前的做法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#多阶段构建-1"><span class="post-toc-number">3.8.2.</span> <span class="post-toc-text">多阶段构建</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#其他制作镜像的方式"><span class="post-toc-number">3.8.3.</span> <span class="post-toc-text">其他制作镜像的方式</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#操作容器"><span class="post-toc-number">4.</span> <span class="post-toc-text">操作容器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#启动"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">启动</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#新建并启动"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">新建并启动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#启动已终止容器"><span class="post-toc-number">4.1.2.</span> <span class="post-toc-text">启动已终止容器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#后台运行"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">后台运行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#终止"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">终止</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进入容器"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">进入容器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#attach命令"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">attach命令</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#exec命令"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">exec命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#导出和导入"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">导出和导入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#导出"><span class="post-toc-number">4.5.1.</span> <span class="post-toc-text">导出</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#导入"><span class="post-toc-number">4.5.2.</span> <span class="post-toc-text">导入</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">删除</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#访问仓库"><span class="post-toc-number">5.</span> <span class="post-toc-text">访问仓库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker-Hub"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Docker Hub</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据管理"><span class="post-toc-number">6.</span> <span class="post-toc-text">数据管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据卷"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">数据卷</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#监听主机目录"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">监听主机目录</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用网络"><span class="post-toc-number">7.</span> <span class="post-toc-text">使用网络</span></a></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                《Docker-从入门到实践》
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/me.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Chunhuan Lin</strong>
        <span>9月 05, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACZ0lEQVR42u3aS27DMAwFwNz/0u22QBvlkbTkpBitAsQfjRcS8cTH178eDzw8PDw8PDw8vDfjPeLx+64/Hv3kyt4zm3PDw8PDO8J7sdQur/n5bxWzRvbmhoeHh3eS92xC69/rCU22nOrc8PDw8N6Zt55oDp68Fw8PD++zeM9K2wSW3IuHh4f3Kbxq3NALJuafcmPWgoeHhxfz8sjg/O+j53t4eHh4Aa/c0lQMF5J7821ge08ZHh4eXsCbHPwnJXXefJCU3euCHg8PD+8uXh46zIOM6tsvSKnx8PDwLuIlC3cPVm0juODT4+Hh4W3m5QXuVcV09UisXO7j4eHhbeYlRfNkcU+uTMruQliMh4eHt5nXC0wvOOBvBQ3RFoKHh4d3E68aVeSY3jZTwOPh4eFt5lUPqKoHY3msMIkq8PDw8E7yJq9MFvpesFttYsDDw8M7yZsw5lFFdSYX9JTh4eHhjXnrBb1aKE8K6/zgrdx0hYeHh7eNVw0jCsf5cStVb9PCw8PDu5c3OabKJz2Pj5sbAx4eHt6YN28XuLYFIf+IhawFDw8PbwMv+d0LI3rHZhdvDHh4eHgHeesX947H8qc1Nxg8PDy8m3jJEl8NFL6Ckbca4OHh4d3Fq45HPHqHWPnGE4UReHh4eBt41enOC+JqI0K1ZMfDw8M7w8sjg0nZnTcWTMIOPDw8vJO8yQIdHU0FmGqxXm4dwMPDw7uJd23rQPUjvngyHh4e3lvyekX5mjrZDPDw8PDu4uWtUZOot3pXtY0ADw8P7wxv0gowWfp7976IPPDw8PA28/7fwMPDw8PDw8PDe4PxDVGP2CTkSRUlAAAAAElFTkSuQmCC">
    
</ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/docker/">docker</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/notes/">notes</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/tools/">tools</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=《Docker-从入门到实践》&url=http://www.chlin.win/book/book-docker/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=《Docker-从入门到实践》&url=http://www.chlin.win/book/book-docker/index.html&via=Chunhuan Lin" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.chlin.win/book/book-docker/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://www.chlin.win/book/book-docker/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>三个基本概念：镜像（Image）、容器（Container）、仓库（Repository）</p>
<h3 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h3><p>操作系统分为内核和用户空间。对于 Linux 而言，内核启动后，会挂载 root文件系统为其提供用户空间支持。而 Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu 16.04 最小系统的 root 文件系统。<br>Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
<h4 id="分层存储"><a href="#分层存储" class="headerlink" title="分层存储"></a>分层存储</h4><p>镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。<br>分层存储的特征还使得镜像的复用、定制变的更为容易。甚至可以用之前构建好的镜像作为基础层，然后进一步添加新的层，以定制自己所需的内容，构建新的镜像。</p>
<h3 id="Docker容器"><a href="#Docker容器" class="headerlink" title="Docker容器"></a>Docker容器</h3><p>镜像（ Image ）和容器（ Container ）的关系，就像是面向对象程序设计中的 类 和 实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。<br>容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。前面讲过镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，<br>在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为容器存储层。<br>容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。<br>按照 Docker 最佳实践的要求，容器不应该向其存储层内写入任何数据，容器存储层要保持无状态化。所有的文件写入操作，都应该使用 数据卷（Volume）、或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主（或网络存储）发生读写，其性能和稳定性更高。<br>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p>
<h3 id="Docker-Registry"><a href="#Docker-Registry" class="headerlink" title="Docker Registry"></a>Docker Registry</h3><p>一个 Docker Registry 中可以包含多个仓库（ Repository ）；每个仓库可以包含多个标签（ Tag ）；每个标签对应一个镜像。<br>通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。我们可以通过 &lt;仓库名&gt;:&lt;标签&gt; 的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以 latest 作为默认标签。<br>仓库名经常以 两段式路径 形式出现，比如 jwilder/nginx-proxy ，前者往往意味着 Docker　Registry 多用户环境下的用户名，后者则往往是对应的软件名。</p>
<h4 id="Docker-Registry-公开服务"><a href="#Docker-Registry-公开服务" class="headerlink" title="Docker Registry 公开服务"></a>Docker Registry 公开服务</h4><p>最常使用的 Registry 公开服务是官方的 Docker Hub，这也是默认的 Registry，并拥有大量的高质量的官方镜像。除此以外，还有 CoreOS 的 Quay.io，CoreOS 相关的镜像存储在这里；Google 的 Google Container Registry，Kubernetes 的镜像使用的就是这个服务。<br>由于某些原因，在国内访问这些服务可能会比较慢。国内的一些云服务商提供了针对 Docker Hub 的镜像服务（ Registry Mirror ），这些镜像服务被称为加速器。常见的有 阿里云加速器、DaoCloud 加速器 等。使用加速器会直接从国内的地址下载 Docker Hub 的镜像，比直接从 Docker Hub 下载速度会提高很多。</p>
<h4 id="私有-Docker-Registry"><a href="#私有-Docker-Registry" class="headerlink" title="私有 Docker Registry"></a>私有 Docker Registry</h4><p>除了使用公开服务外，用户还可以在本地搭建私有 Docker Registry。Docker 官方提供了Docker Registry 镜像，可以直接使用做为私有 Registry 服务。</p>
<h4 id="高级服务"><a href="#高级服务" class="headerlink" title="高级服务"></a>高级服务</h4><p>开源的 Docker Registry 镜像只提供了 Docker Registry API 的服务端实现，足以支持docker 命令，不影响使用。但不包含图形界面，以及镜像维护、用户管理、访问控制等高级功能。在官方的商业化版本 Docker Trusted Registry 中，提供了这些高级功能。<br>除了官方的 Docker Registry 外，还有第三方软件实现了 Docker Registry API，甚至提供了用户界面以及一些高级功能。比如，VMWare Harbor 和 Sonatype Nexus。</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p>详情见书籍，注意使用国内源，并配置加速器</p>
<h2 id="使用镜像"><a href="#使用镜像" class="headerlink" title="使用镜像"></a>使用镜像</h2><h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><p><code>docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></p>
<ul>
<li>选项：<code>docker pull --help</code>查看</li>
<li>Docker 镜像仓库地址：地址的格式一般是 &lt;域名/IP&gt;[:端口号] 。默认地址是 Docker Hub</li>
<li>仓库名：如之前所说，这里的仓库名是两段式名称，即 &lt;用户名&gt;/&lt;软件名&gt; 。对于 Docker Hub，如果不给出用户名，则默认为 library ，也就是官方镜像   </li>
</ul>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p><code>docker run -it --rm ubuntu:16.04 bash</code></p>
<ul>
<li>-it ：这是两个参数，一个是 -i ：交互式操作，一个是 -t 终端。我们这里打算进入bash 执行一些命令并查看返回结果，因此我们需要交互式终端。</li>
<li>–rm ：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 docker rm 。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 –rm 可以避免浪费空间。</li>
<li>ubuntu:16.04 ：这是指用 ubuntu:16.04 镜像为基础来启动容器。</li>
<li>bash ：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 bash 。  </li>
</ul>
<h3 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h3><p><code>docker image ls</code>  </p>
<h4 id="镜像体积"><a href="#镜像体积" class="headerlink" title="镜像体积"></a>镜像体积</h4><ul>
<li>docker image ls</li>
</ul>
<ul>
<li>Docker Hub上是压缩体积，而本地是展开后的体积，因此本地大</li>
<li>由于镜像的多层结构，有一些可以继承、复用，因此实际占用空间小于列表中显示的空间总和</li>
</ul>
<ul>
<li>docker system df</li>
</ul>
<ul>
<li>便捷的查看镜像、容器、数据卷所占用的空间  </li>
</ul>
<h4 id="虚悬镜像"><a href="#虚悬镜像" class="headerlink" title="虚悬镜像"></a>虚悬镜像</h4><ul>
<li>特点：仓库名、标签等信息都是<none></none></li>
<li>显示这类镜像：docker image ls -f dangling=true</li>
<li>产生原因：旧镜像名称与新镜像同名，故被抹去信息</li>
<li>产生环境：docker pull或docker build时，可能产生这种现象</li>
<li>删除：docker image prune  </li>
</ul>
<h4 id="中间层镜像"><a href="#中间层镜像" class="headerlink" title="中间层镜像"></a>中间层镜像</h4><ul>
<li>docker image ls -a 将会把中间层镜像也显示出来</li>
<li>特点：无标签</li>
<li>删除： 不能删除此类镜像，在将依赖他们的镜像删除后，他们自然会被删除  </li>
</ul>
<h4 id="列出部分镜像"><a href="#列出部分镜像" class="headerlink" title="列出部分镜像"></a>列出部分镜像</h4><ul>
<li>根据仓库名：docker iamge ls &lt;仓库名&gt;</li>
<li>指定仓库名和标签：docker image ls &lt;仓库名：标签&gt;</li>
<li>过滤器：加入–filter或-f参数，常用的filter参数有：since/before/label等</li>
<li>只列出id: -q参数</li>
<li>按一定格式输出，–format 参数， 并利用GO的模板语法  </li>
</ul>
<h3 id="删除本地镜像"><a href="#删除本地镜像" class="headerlink" title="删除本地镜像"></a>删除本地镜像</h3><p><code>docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; ...]</code>  </p>
<h4 id="用ID、镜像名、摘要删除镜像"><a href="#用ID、镜像名、摘要删除镜像" class="headerlink" title="用ID、镜像名、摘要删除镜像"></a>用ID、镜像名、摘要删除镜像</h4><ul>
<li>短ID和长ID<ul>
<li>可以用镜像的长ID，也即完整ID</li>
<li>更方便的，可以用短ID，即长ID的前几位（一般3位），只要能够区分不同镜像即可。</li>
</ul>
</li>
<li>镜像名<ul>
<li>即&lt;仓库名&gt;:&lt;标签&gt;</li>
</ul>
</li>
<li>镜像摘要<ul>
<li><code>docker iamge ls --digests</code> 列出摘要</li>
<li><code>docker iamge rm &lt;res&gt;@&lt;digest&gt;</code></li>
</ul>
</li>
<li>配合<code>docker image ls</code>命令<ul>
<li><code>docker image rm $(docker image ls -q redis)</code></li>
<li><code>docker image rm $(docker image ls -q -f before=mongo:3.2)</code>  </li>
</ul>
</li>
</ul>
<h5 id="Untagged-和Deleted"><a href="#Untagged-和Deleted" class="headerlink" title="Untagged 和Deleted"></a>Untagged 和Deleted</h5><ul>
<li>删除镜像时，会显示Untagged或Deleted信息</li>
<li>镜像的唯一标识是ID和摘要，一个镜像可以有多个标签</li>
<li>删除镜像时，实际上是删除某个标签的镜像，因此得到Untagged信息。 </li>
<li>输出的是Deleted信息，必须<em>同时</em>满足：<ul>
<li>该镜像所有标签都没有了</li>
<li>没有任何层依赖当前层</li>
<li>此时没有这个镜像启动的容器存在  </li>
</ul>
</li>
</ul>
<h3 id="利用commit理解镜像构成"><a href="#利用commit理解镜像构成" class="headerlink" title="利用commit理解镜像构成"></a>利用commit理解镜像构成</h3><ul>
<li>用于学习，也可以用于被入侵后保留现场</li>
<li>不要用<code>docker commit</code>定制镜像，应该使用<code>Dockerfile</code></li>
<li>具体学习内容见书籍</li>
<li><p>进行一个简单的实验，我们运行一个镜像的容器，然后对这个容器进行修改，那么容器的<em>存储层</em>会发生改变，换言之，原有镜像+容器的存储层==新镜像，这时候就可以commit：<br><code>docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</code><br>例如可以这样保存：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> $ docker commit	\</div><div class="line">--author &quot;Tao Wang &lt;twang2218@gmail.com&gt;&quot; \ //作者信息</div><div class="line">--message &quot;修改了默认网页&quot; \ // 修改的内容说明</div><div class="line">webserver \ // 容器名称</div><div class="line">nginx:v2 // 修改后保存的镜像名称</div></pre></td></tr></table></figure>
</li>
<li><p>几个命令</p>
<ul>
<li><code>docker diff &lt;容器名&gt;</code></li>
<li><code>docker history &lt;镜像名&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="慎用docker-commit"><a href="#慎用docker-commit" class="headerlink" title="慎用docker commit"></a>慎用<code>docker commit</code></h4><ul>
<li>利用commit方法，生成镜像时，产生大量无用文件</li>
<li>别人无从得知这个镜像是如何得到的，因此，这种方式得到的镜像也被称为“黑箱镜像”</li>
<li>每一次修改只会增加新层，对旧层无法删除，因此会使镜像变得臃肿</li>
</ul>
<h3 id="使用Dockerfile定制镜像"><a href="#使用Dockerfile定制镜像" class="headerlink" title="使用Dockerfile定制镜像"></a>使用Dockerfile定制镜像</h3><p>Dockerfile是一个文本文件,其内包含了一条条的指令(Instruction),每一条指令构建一层,因此每一条指令的内容,就是描述该层应当如何构建。</p>
<h4 id="FROM指定基础镜像"><a href="#FROM指定基础镜像" class="headerlink" title="FROM指定基础镜像"></a>FROM指定基础镜像</h4><ul>
<li>必须是第一条指令</li>
<li>指示从哪个镜像开始修改</li>
<li><a href="https://store.docker.com" target="_blank" rel="external">Docker Store</a>有很多官方镜像。服务类镜像，如<a href="https://store.docker.com/images/python/" target="_blank" rel="external">python</a>、操作系统镜像，如<a href="https://store.docker.com/images/ubuntu/" target="_blank" rel="external">ubuntu</a></li>
<li>特别地，存在一个空白镜像，名为<code>scratch</code>,适用于可执行文件直接复制到docker，而无需操作系统支持的情况；其次，使用Go语言开发的应用很多会使用这种方式制作镜像。</li>
</ul>
<h4 id="RUN执行命令"><a href="#RUN执行命令" class="headerlink" title="RUN执行命令"></a>RUN执行命令</h4><ul>
<li><code>RUN</code>指令有两种格式：<ul>
<li>shell格式，<code>RUN &lt;命令&gt;</code></li>
<li>exec格式，<code>RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]</code></li>
</ul>
</li>
<li>RUN指令也是每个指令会新建一层，故不能每行都写RUN</li>
<li>Union FS目前最大不得超过127层</li>
<li>注意能用一层写就用一层，可以使用<em>&amp;&amp;</em>连接符;在最后要进行<em>清理工作</em></li>
</ul>
<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><p>得到<code>Dockerfile</code>之后就可以开始构建镜像了,在<em>Dockerfile所在目录</em>运行<br><code>docker    build    [选项]    &lt;上下文路径/URL/-&gt;</code><br>如： <code>docker build -t nginx:v3 .</code></p>
<h4 id="镜像构建上下文（Context）"><a href="#镜像构建上下文（Context）" class="headerlink" title="镜像构建上下文（Context）"></a>镜像构建上下文（Context）</h4><ul>
<li>构建镜像时用到的上下文路径并非指<code>Dockerfile</code>路径</li>
<li><code>docker build</code>的工作原理实则是C/S设计的模式，<code>docker</code>命令作为客户端，调用远程Docker引擎的API，进而进行build。而构建镜像时，可能需要用到本地的文件，为了使得远程引擎可以获得这些地址，需要告诉他们上下文信息，这样Dockerfile中的路径，就可以被正确的解读。</li>
<li>正确方法是：<ul>
<li>在空目录/项目根目录下放置Dockerfile</li>
<li>将所需的文件拷贝一份到当前目录下</li>
<li>如果当前目录下有不需要传给Docker引擎的，那么可以用<code>.gitignore</code>的语法，写一个<code>.dockerignore</code></li>
</ul>
</li>
<li>默认会将上下文目录中的<code>Dockerfile</code>文件视作Dockerfile，实际上可以通过-f参数，对Dockerfile进行配置</li>
</ul>
<h4 id="其他docker-build用法"><a href="#其他docker-build用法" class="headerlink" title="其他docker build用法"></a>其他<code>docker build</code>用法</h4><ol>
<li>Git repo, 如docker build <a href="https://github.com/twang2218/gitlab-ce-zh.git" target="_blank" rel="external">https://github.com/twang2218/gitlab-ce-zh.git</a></li>
<li>tar压缩包，如<code>docker    build http://server/context.tar.gz</code></li>
<li>从标准输入中读取Dockerfile（文本文件），如<code>docker build - &lt; Dockerfile</code>或<code>cat Dockerfile | docker build -</code></li>
<li>从标准输入中读取上下文压缩包（压缩包格式文件），如 <code>docker build - &lt; context.tar.gz</code> </li>
</ol>
<h3 id="Dockerfile指令详解"><a href="#Dockerfile指令详解" class="headerlink" title="Dockerfile指令详解"></a>Dockerfile指令详解</h3><p>除了<code>FROM</code>，<code>RUN</code>，<code>Dockerfile</code>还有很多其他指令。<br>参考文档：</p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="external">Dockerfile官方文档</a></li>
<li><a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="external">Dockerfile最佳实践文档</a></li>
<li><a href="https://github.com/docker-library/docs" target="_blank" rel="external">Docker官方镜像的Dockerfile</a></li>
</ul>
<h4 id="COPY复制文件"><a href="#COPY复制文件" class="headerlink" title="COPY复制文件"></a>COPY复制文件</h4><ul>
<li>格式<ul>
<li><code>COPY &lt;源路径&gt;... &lt;目标路径&gt;</code></li>
<li><code>COPY [&quot;&lt;源路径1&gt;&quot;,... &quot;&lt;目标路径&gt;&quot;]</code></li>
</ul>
</li>
<li>可以有多个源路径，可以使用通配符，规则与Go的<a href="https://golang.org/pkg/path/filepath/#Match" target="_blank" rel="external">filepath.Match</a>一致</li>
<li>会保留源文件的元数据，比如说文件权限，变更时间等</li>
</ul>
<h4 id="ADD更高级的复制文件"><a href="#ADD更高级的复制文件" class="headerlink" title="ADD更高级的复制文件"></a>ADD更高级的复制文件</h4><ul>
<li>高配版COPY，具体表现在：<ul>
<li>源文件可以是<code>URL</code>，但这个命令有限制，所以不实用，不如直接使用<code>RUN</code></li>
<li>自动解压缩，如果源文件是压缩文件，会自动解压到<code>目标路径</code></li>
</ul>
</li>
<li>建议： <em>仅在需要自动解压缩的场合使用<code>ADD</code></em></li>
</ul>
<h4 id="CMD容器启动命令"><a href="#CMD容器启动命令" class="headerlink" title="CMD容器启动命令"></a>CMD容器启动命令</h4><ul>
<li>容器就是进程，因此启动容器时，需要指定所运行的程序和参数，这就用到了CMD</li>
<li>在运行时，可以指定新的命令来替代镜像设置中CMD的命令。比如,<code>ubuntu</code>镜像默认的<code>CMD</code>是<code>/bin/bash</code>,如果我们直接<code>docker run -it ubuntu</code>的话,会直接进入<code>bash</code> 。我们也可以在运行时指定运行别的命令,如<code>docker run -it ubuntu cat /etc/os-release</code>。这就是用<code>cat /etc/os-release</code>命令替换了默认的<code>/bin/bash</code>命令了,输出了系统版本信息。</li>
<li>格式–推荐使用<em>exec</em>格式<ul>
<li>shell格式: <code>CMD &lt;命令&gt;</code></li>
<li>exec格式: <code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code>    </li>
<li>参数列表格式: <code>CMD [&quot;参数1&quot;, &quot;参数2&quot;...]</code>。在指定了<code>ENTRYPOINT</code>指令后,用<code>CMD</code>指定具体的参数。</li>
</ul>
</li>
<li>容器内没有后台服务的概念，不能像虚拟机、物理机那样启动后台服务，应该直接执行可执行文件，并要求以前台形式运行，如：<code>CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</code></li>
</ul>
<h4 id="ENTRYPOINT入口点"><a href="#ENTRYPOINT入口点" class="headerlink" title="ENTRYPOINT入口点"></a>ENTRYPOINT入口点</h4><ul>
<li><code>ENTRYPOINT</code>和<code>CMD</code>一样，都用于指定容器启动程序和参数</li>
<li>当制定<code>ENTRYPOINT</code>后，<code>CMD</code>的内容就只能是作为<code>ENTRYPOINT</code>的参数</li>
<li><code>ENTRYPOINT</code>可以在容器启动时，被替代；不过与<code>CMD</code>不同的是，他需要特别的使用<code>--entrypoint</code>参数来指定</li>
<li>使用场合：<ul>
<li>让镜像变成像命令一样使用<br>由容器运行的格式，<code>docker run &lt;镜像&gt; &lt;CMD&gt;</code>，那么如果我们在Dockerfile里指定的是<code>ENTRYPOINT</code>，我们<cmd>就可以作为参数传递给<code>ENTRYPOINT</code>，这样就使得镜像可以像命令一样使用（可以传递参数）</cmd></li>
<li>应用运行前的准备工作<br>可以写一个脚本，这个脚本由<code>ENTRYPOINT</code>启动运行，这里将会执行一些主程序运行前的准备工作；然后在<code>CMD</code>写如最后需要执行的命令，它将作为参数传入到该脚本中，交给该脚本最终运行。</li>
</ul>
</li>
</ul>
<h4 id="ENV设置环境变量"><a href="#ENV设置环境变量" class="headerlink" title="ENV设置环境变量"></a>ENV设置环境变量</h4><ul>
<li>格式:<ul>
<li><code>ENV &lt;key&gt; &lt;value&gt;</code></li>
<li><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li>
</ul>
</li>
<li>使用方法<ul>
<li><code>\</code>可以用于换行，对含空格的值可以用双引号括起来</li>
<li>使用：<code>$key</code></li>
</ul>
</li>
</ul>
<h4 id="ARG构建参数"><a href="#ARG构建参数" class="headerlink" title="ARG构建参数"></a>ARG构建参数</h4><ul>
<li>格式：<code>ARG &lt;参数名&gt;[=&lt;默认值&gt;]</code></li>
<li>同样用于设置环境变量，但这个变量在容器运行时是不会存在的</li>
<li><code>ARG</code>设置的变量和默认值可以在构建命令（<code>docker build</code>）时，加入<code>--build-arg &lt;参数名&gt;=&lt;值&gt;</code>来覆盖</li>
</ul>
<h4 id="VOLUME定义匿名卷"><a href="#VOLUME定义匿名卷" class="headerlink" title="VOLUME定义匿名卷"></a>VOLUME定义匿名卷</h4><ul>
<li>格式：<ul>
<li><code>VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</code></li>
<li><code>VOLUME &lt;路径&gt;</code></li>
</ul>
</li>
<li>为保证容器存储层不发生写操作，对数据库类需要保存动态数据的应用，其数据库文件应该保存到<code>卷（volume）</code>中</li>
<li>可以事先制定某些目录挂载为匿名卷</li>
</ul>
<h4 id="EXPOSE声明端口"><a href="#EXPOSE声明端口" class="headerlink" title="EXPOSE声明端口"></a>EXPOSE声明端口</h4><ul>
<li>格式：<code>EXPOSE &lt;端口1&gt;    [&lt;端口2&gt;...]</code></li>
<li><code>EXPOSE</code>指令是声明运行时容器提供服务端口,这只是一个声明,在运行时并不会因为这个声明应用就会开启这个端口的服务。在<code>Dockerfile</code>中写入这样的声明有两个好处,一个是帮助镜像使用者理解这个镜像服务的守护端口,以方便配置映射;另一个用处则是在运行时使用随机端口映射时,也就是<code>docker run -P</code>时,会自动随机映射<code>EXPOSE</code>端口。</li>
<li>要将<code>EXPOSE</code>和在运行时使用<code>-p &lt;宿主端口&gt;:&lt;容器端口&gt;</code>区分开来。<code>-p</code>,是映射宿主端口和容器端口,换句话说,就是将容器的对应端口服务公开给外界访问,而<code>EXPOSE</code>仅仅是声明容器打算使用什么端口而已,并不会自动在宿主进行端口映射。</li>
</ul>
<h4 id="WORKDIR指定工作目录"><a href="#WORKDIR指定工作目录" class="headerlink" title="WORKDIR指定工作目录"></a>WORKDIR指定工作目录</h4><ul>
<li>格式：<code>WORKDIR &lt;工作目录路径&gt;</code>    </li>
<li>使用<code>WORKDIR</code>指令可以来指定工作目录(或者称为当前目录),以后各层的当前目录就被改为指定的目录,如该目录不存在,<code>WORKDIR</code>会帮你建立目录。</li>
<li><p>理解工作目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RUN cd /app</div><div class="line">RUN echo &quot;hello&quot; &gt; world.txt</div></pre></td></tr></table></figure>
<p>上述命令并不会真正的cd到/app目录，并在该目录下创建文件。这是由于在shell中连续两行是在同一个进程中执行，而docker中，两个<code>RUN</code>实质实在不同的执行环境中执行的，两个镜像层之间互不影响，因此此时就需要使用WORKDIR。</p>
</li>
</ul>
<h4 id="USER指定当前用户"><a href="#USER指定当前用户" class="headerlink" title="USER指定当前用户"></a>USER指定当前用户</h4><ul>
<li>格式：<code>USER &lt;用户名&gt;</code></li>
<li><code>USER</code>改变之后的层的用户，但这个用户必须在事先建立好</li>
<li><p>案例一：建立用户并执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</div><div class="line">USER redis</div><div class="line">RUN [&quot;redis-server&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>案例二：使用<code>gosu</code>，以<code>root</code>来执行脚本，并且在执行期间改变身份。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 建立redis用户,并使用gosu换另一个用户执行命令</div><div class="line">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</div><div class="line"># 下载gosu</div><div class="line">RUN wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64&quot; \</div><div class="line">    &amp;&amp; chmod +x /usr/local/bin/gosu \</div><div class="line">    &amp;&amp; gosu nobody true</div><div class="line"># 设置CMD,并以另外的用户执行</div><div class="line">CMD [&quot;exec&quot;, &quot;gosu&quot;, &quot;redis&quot;, &quot;redis-server&quot;]</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="HEALTHCHECK健康检查"><a href="#HEALTHCHECK健康检查" class="headerlink" title="HEALTHCHECK健康检查"></a>HEALTHCHECK健康检查</h4><ul>
<li>格式：<ul>
<li><code>HEALTHCHECK [选项] CMD &lt;命令&gt;</code>:设置检查容器健康状况的命令</li>
<li><code>HEALTHCHECK NONE</code>:如果基础镜像有健康检查指令,使用这行可以屏蔽掉其健康检查指令</li>
</ul>
</li>
<li>与<code>CMD</code>，<code>ENTRYPOINT</code>一样，<code>HEALTHCHECK</code>只可以出现一次，如果写了多个，只有最后一个生效</li>
<li>选项：<ul>
<li><code>--interval=&lt;间隔&gt;</code>：两次健康检查的间隔,默认为30秒</li>
<li><code>--timeout=&lt;时长&gt;</code>：健康检查命令运行超时时间,如果超过这个时间,本次健康检查就被视为失败,默认30秒</li>
<li><code>--retries=&lt;次数&gt;</code>：当连续失败指定次数后,则将容器状态视为<code>unhealthy</code>,默认3次 </li>
</ul>
</li>
<li>使用:    <ul>
<li>命令返回值分别为：0:成功;1:失败;2:保留,不要使用这个值，可以在命令后加<code>|| exit 1</code>以只显示0或1</li>
<li>运行镜像后，运行<code>docker ps</code>查看健康状态；<code>docker inspect</code>查看健康检查命令的输出</li>
</ul>
</li>
</ul>
<h4 id="ONBUILD为他人做嫁衣裳"><a href="#ONBUILD为他人做嫁衣裳" class="headerlink" title="ONBUILD为他人做嫁衣裳"></a>ONBUILD为他人做嫁衣裳</h4><ul>
<li>格式：<code>ONBUILD &lt;其它指令&gt;</code></li>
<li>它后面跟的是其它指令,比如<code>RUN</code>,<code>COPY</code>等,而这些指令,在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像,去构建下一级镜像的时候才会被执行。</li>
<li>用于写基础镜像，方便其他镜像继承</li>
</ul>
<h3 id="多阶段构建"><a href="#多阶段构建" class="headerlink" title="多阶段构建"></a>多阶段构建</h3><h4 id="之前的做法"><a href="#之前的做法" class="headerlink" title="之前的做法"></a>之前的做法</h4><ul>
<li>全部放入一个Dockerfile<ul>
<li>Dockerfile 特别长,可维护性降低</li>
<li>镜像层次多,镜像体积较大,部署时间变长</li>
<li>源代码存在泄露的风险</li>
</ul>
</li>
<li>分散到多个Dockerfile<ul>
<li>部署过程复杂</li>
</ul>
</li>
</ul>
<h4 id="多阶段构建-1"><a href="#多阶段构建-1" class="headerlink" title="多阶段构建"></a>多阶段构建</h4><ul>
<li>写到一个Dockerfile里</li>
<li>不同阶段用<code>FROM</code>隔开</li>
</ul>
<h4 id="其他制作镜像的方式"><a href="#其他制作镜像的方式" class="headerlink" title="其他制作镜像的方式"></a>其他制作镜像的方式</h4><ol>
<li>从rootfs压缩包导入</li>
<li><code>docker save</code>和<code>docker load</code><ul>
<li>用于镜像迁移，现在更推荐<code>Docker Registry</code></li>
<li>保存镜像：<code>docker save alpine | gzip &gt; alpine-latest.tar.gz</code></li>
<li>加载镜像：<code>docker load -i alpine-latest.tar.gz</code></li>
</ul>
</li>
</ol>
<h2 id="操作容器"><a href="#操作容器" class="headerlink" title="操作容器"></a>操作容器</h2><p>简单的说,容器是独立运行的一个或一组应用,以及它们的运行态环境。对应的,虚拟机可以理解为模拟运行的一整套操作系统(提供了运行态环境和其他系统环境)和跑在上面的应用。</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>启动容器有两种方式,一种是基于镜像新建一个容器并启动,另外一个是将在终止状态(<code>stopped</code>)的容器重新启动。<br>因为<code>Docker</code>的容器实在太轻量级了,很多时候用户都是随时删除和新创建容器。</p>
<h4 id="新建并启动"><a href="#新建并启动" class="headerlink" title="新建并启动"></a>新建并启动</h4><ul>
<li>命令：<code>docker run</code></li>
<li>当利用<code>docker run</code>来创建容器时,Docker    在后台运行的标准操作包括:<ul>
<li>检查本地是否存在指定的镜像,不存在就从公有仓库下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统,并在只读的镜像层外面挂载一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li>
<li>从地址池配置一个<code>ip</code>地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止 </li>
</ul>
</li>
<li>常用参数：<ul>
<li>-t：让Docker分配一个伪终端(pseudo-tty)并绑定到容器的标准输入上,     </li>
<li>-i：让容器的标准输入保持打开。</li>
</ul>
</li>
</ul>
<h4 id="启动已终止容器"><a href="#启动已终止容器" class="headerlink" title="启动已终止容器"></a>启动已终止容器</h4><ul>
<li>命令：<code>docker container start</code></li>
</ul>
<h3 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h3><ul>
<li>使用<code>-d</code>参数运行容器，则执行结果不会打印到宿主机上</li>
<li>可以用<code>docker container ls</code>查看容器信息</li>
<li><code>docker container logs [container ID or NAMES]</code>查看容器输出信息</li>
</ul>
<h3 id="终止"><a href="#终止" class="headerlink" title="终止"></a>终止</h3><ul>
<li>命令：<code>docker container stop</code></li>
<li>此外,当<code>Docker</code>容器中指定的应用终结时,容器也自动终止。</li>
<li>终止状态的容器可以用<code>docker container ls -a</code>命令看到</li>
</ul>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><p><code>-d</code>会使容器进入后台，某些时候需要进入容器进行操作,包括使用<code>docker attach</code>命令或<code>docker exec</code>命令,推荐大家使用<code>docker exec</code>命令</p>
<h4 id="attach命令"><a href="#attach命令" class="headerlink" title="attach命令"></a><code>attach</code>命令</h4><p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker run -dit ubuntu</div><div class="line">docker attach &lt;container&gt;</div></pre></td></tr></table></figure></p>
<h4 id="exec命令"><a href="#exec命令" class="headerlink" title="exec命令"></a><code>exec</code>命令</h4><ul>
<li>与<code>attach</code>的使用类似，但是在<code>exec</code>的<code>stdin</code>中<code>exit</code>不会导致容器停止，因此推荐<code>exec</code>命令</li>
</ul>
<h3 id="导出和导入"><a href="#导出和导入" class="headerlink" title="导出和导入"></a>导出和导入</h3><h4 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h4><ul>
<li>命令：<code>docker export</code></li>
<li>示例：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker ps -a</div><div class="line">docker export &lt;container id&gt; &gt; &lt;name.tar&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h4><ul>
<li>命令：<code>docker import</code></li>
<li>示例：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cat ubuntu.tar | docker import - test/ubuntu:v1.0</div><div class="line">docker image ls</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li>删除一个处于终止状态的容器<br><code>docker container rm &lt;container&gt;</code></li>
<li>删除所有处于终止状态的容器<br><code>docker container prune</code></li>
</ul>
<h2 id="访问仓库"><a href="#访问仓库" class="headerlink" title="访问仓库"></a>访问仓库</h2><p>仓库(<code>Repository</code>)是集中存放镜像的地方。<br>一个容易混淆的概念是注册服务器(<code>Registry</code>)。实际上注册服务器是管理仓库的具体服务器,每个服务器上可以有多个仓库,而每个仓库下面有多个镜像。从这方面来说,仓库可以被认为是一个具体的项目或目录。例如对于仓库地址<code>dl.dockerpool.com/ubuntu</code>来说,<code>dl.dockerpool.com</code>是注册服务器地址,<code>ubuntu</code>是仓库名。大部分时候,并不需要严格区分这两者的概念。</p>
<h3 id="Docker-Hub"><a href="#Docker-Hub" class="headerlink" title="Docker Hub"></a>Docker Hub</h3><ul>
<li>注册与登录<ol>
<li><a href="https://cloud.docker.com" target="_blank" rel="external">官网</a>注册</li>
<li><code>docker login</code>登录；<code>docker logout</code>登出</li>
</ol>
</li>
<li>查找镜像<ul>
<li><code>docker search &lt;关键字&gt;</code></li>
<li>镜像名称：官方镜像通常是单个单词；用户创建的通常格式为<code>username/image</code></li>
<li><code>--filter=stars=N</code>参数，指定只搜索star数量为N以上的镜像</li>
</ul>
</li>
<li>下载镜像<br><code>docker pull &lt;镜像名&gt;</code></li>
<li>推送镜像<ol>
<li><code>docker tag ubuntu:17.10 username/ubuntu:17.10</code></li>
<li><code>docker image ls</code> 查看是否以生成名为<code>username/ubuntu:17.10</code>的镜像</li>
<li><code>docker push username/ubuntu:17.10</code></li>
<li><code>docker search username</code>可以找到自己上传的镜像了</li>
</ol>
</li>
<li>自动创建<br>自动创建允许用户通过<code>Docker Hub</code>指定跟踪一个目标网站(目前支持<code>GitHub</code>或<code>BitBucket</code>)上的项目,一旦项目发生新的提交或者创建新的标签(tag),<code>Docker Hub</code>会自动构建镜像并推送到<code>Docker Hub</code>中。</li>
</ul>
<h2 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h2><p>这一章介绍如何在<code>Docker</code>内部以及容器之间管理数据</p>
<h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><p><code>数据卷</code>是一个可供一个或多个容器使用的特殊目录,它绕过<code>UFS</code>,可以提供很多有用的特性:</p>
<ul>
<li><code>数据卷</code>可以在容器之间共享和重用</li>
<li>对<code>数据卷</code>的修改会立马生效</li>
<li>对<code>数据卷</code>的更新,不会影响镜像</li>
<li><code>数据卷</code>默认会一直存在,即使容器被删除<blockquote>
<p>注意:  数据卷的使用,类似于Linux下对目录或文件进行mount,镜像中的被指定为挂载点的目录中的文件会隐藏掉,能显示看的是挂载的<code>数据卷</code>。</p>
</blockquote>
</li>
</ul>
<h3 id="监听主机目录"><a href="#监听主机目录" class="headerlink" title="监听主机目录"></a>监听主机目录</h3><h2 id="使用网络"><a href="#使用网络" class="headerlink" title="使用网络"></a>使用网络</h2>
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/Linux/network_config/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/book/book-intelligence/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/me.jpg" alt="Chunhuan Lin's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        lch_xdu@163.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: lch_xdu@163.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Deep-Learning/">Deep Learning<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Linux/">Linux<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Server/">Server<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/book/">book<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/notes/">notes<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/projects/">projects<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                标签
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/ChunhuanLin" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Chunhuan Lin
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>







<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
